<mvc:View controllerName="iot.planner.components.managecategories.controller.Worklist"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:t="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns:semantic="sap.f.semantic">
    <Page showHeader="false">
        <fb:FilterBar header="{i18n>worklistTitle}" considerGroupTitle="true" reset="onReset" search="loadData" showRestoreButton="true" showClearButton="true" showGoOnFB="true">
            <fb:filterGroupItems >
                <fb:FilterGroupItem label="{i18n>search}" groupName="search" name="search" partOfCurrentVariant="true" visibleInFilterBar="true">
                    <fb:control>
                        <SearchField value="{worklistView>/filters/search}" search="onSearch" />
                    </fb:control>
                </fb:FilterGroupItem>
                <fb:FilterGroupItem label="{i18n>scope}" groupName="scope" name="scope" partOfCurrentVariant="true" visibleInFilterBar="true">
                    <fb:control>
                        <Select selectedKey="{worklistView>/filters/scope}">
                            <core:Item text="{i18n>scope.mine}" key="mine"/>
                            <core:Item text="{i18n>scope.all}" key="all"/>
                        </Select>
                    </fb:control>
                </fb:FilterGroupItem>
                <fb:FilterGroupItem label="{i18n>validAt}" groupName="validity" name="validFrom" partOfCurrentVariant="true" visibleInFilterBar="true">
                    <fb:control>
                        <DatePicker value="{path: 'worklistView>/filters/validAt', type:'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}"/>
                    </fb:control>
                </fb:FilterGroupItem>
            </fb:filterGroupItems>
        </fb:FilterBar>
        <t:TreeTable busy="{worklistView>/busy}" busyIndicatorDelay="{worklistView>/busyIndicatorDelay}" id="treeTable" selectionMode="Multi" rowSelectionChange="onSelect" showNoData="true" rows="{path: '/Categories', 
        sorter: [{path: 'shallowReference'}],
        parameters: {numberOfExpandedLevels: 0, arrayNames: ['children']}}" visibleRowCount="20" selectionBehavior="Row" rowActionCount="3" sort="onSort">
            <t:noData>
                <Title text=""/>
            </t:noData>
            <t:extension>
                <OverflowToolbar >
                    <Title text="Categories"/>
                    <ToolbarSpacer/>
                    <Button text="{i18n>create}" press="onPressCreateCategory"/>
                    <Button text="{i18n>delete}" press="onPressDeleteCategories"/>
                </OverflowToolbar>
            </t:extension>
            <t:rowActionTemplate>
                <t:RowAction>
                    <t:RowActionItem type="Custom" icon="sap-icon://add" press="onPressAddCategory"/>
                    <t:RowActionItem type="Custom" icon="sap-icon://edit" press="onPressUpdateCategory"/>
                    <!-- <t:RowActionItem type="Custom" icon="sap-icon://delete" press="onPressDeleteCategory"/> -->
                </t:RowAction>
            </t:rowActionTemplate>
            <t:columns>
                <t:Column label="{i18n>title}" width="30%">
                    <t:template>
                        <Text text="{title}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>childrenLength}" width="8%" hAlign="End">
                    <t:template>
                        <Text text="{= ${children}.length}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>shallowReference}" width="10%">
                    <t:template>
                        <Text text="{shallowReference}"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>absoluteReference}" width="10%">
                    <t:template>
                        <Text text="{absoluteReference}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>validFrom}" width="10%">
                    <t:template>
                        <Text text="{path: 'validFrom', type:'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}" />
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>validTo}" width="10%">
                    <t:template>
                        <Text text="{path: 'validTo', type:'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>invoiceRelevance}" id="invoiceRelevanceColumn" width="10%">
                    <t:template>
                        <Text text="{invoiceRelevance}"/>
                    </t:template>
                </t:Column>
                <t:Column label="{i18n>bonusRelevance}" id="bonusRelevanceColumn" width="10%">
                    <t:template>
                        <Text text="{bonusRelevance}"/>
                    </t:template>
                </t:Column>
            </t:columns>
        </t:TreeTable>
        <dependents>
            <Dialog id="editCategoryDialog" initialFocus="titleInput" contentHeight="100%" contentWidth="73%">
                <f:SimpleForm editable="true">
                    <core:Title text="{i18n>reference}"/>
                    <Label text="{i18n>title}"/>
                    <TextArea id="titleInput" value="{title}"/>
                    <Label text="{i18n>shallowReference}"/>
                    <Input id="shallowReferenceInput" value="{shallowReference}" />
                    <Label text="{i18n>absoluteReference}"/>
                    <Input id="referenceInput" value="{absoluteReference}" />
                    <Label text="{i18n>mappingID}"/>
                    <Input id="mappingIdInput" value="{mappingID}" />
                    <core:Title text="{i18n>validity}"/>
                    <Label text="{i18n>validFrom}"/>
                    <DatePicker value="{path: 'validFrom', type:'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}"/>
                    <Label text="{i18n>validTo}"/>
                    <DatePicker value="{path: 'validTo', type:'sap.ui.model.type.Date', formatOptions: {style: 'medium'}}"/>
                    <Label text="{i18n>invoiceRelevance}"/>
                    <Input id="invoiceRelevanceInput" value="{invoiceRelevance}"/>
                    <Label text="{i18n>bonusRelevance}"/>
                    <Input id="bonusRelevanceInput" value="{bonusRelevance}"/>
                    <core:Title text="{i18n>members}"/>
                    <Label text="{i18n>members}" labelFor="membersInput"/>
                    <MultiInput id="membersInput" tokens="{path: 'members'}" suggestionItems="{
                                    path: 'OData>/Users',
                                    sorter: { path: 'displayName' }
                                }" showValueHelp="false" tokenUpdate="onUpdateUsers2Categories">
                        <suggestionItems>
                            <core:Item key="{OData>userPrincipalName}" text="{OData>displayName}"/>
                        </suggestionItems>
                        <tokens >
                            <Token key="{user_userPrincipalName}" text="{displayName}"/>
                        </tokens>
                    </MultiInput>
                </f:SimpleForm>
                <customHeader>
                    <Bar>
                        <contentMiddle>
                            <Title text="{worklistView>/popoverTitle}" />
                        </contentMiddle>
                        <contentRight>
                            <Button icon="sap-icon://decline" press="onPressClosePopover"/>
                        </contentRight>
                    </Bar>
                </customHeader>
                <endButton>
                    <Button type="Emphasized" text="{i18n>OK}" press="onPressSubmitCategory"/>
                </endButton>
            </Dialog>
        </dependents>
    </Page>
</mvc:View>